
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"/>

		<!-- GitHub icons and styles -->
		<link rel="stylesheet" href="assets/bower_components/octicons/octicons/octicons.css"/>

		<!-- Bootstrap -->
		<link rel="stylesheet" href="assets/bower_components/bootstrap/dist/css/bootstrap.min.css"/>
		<link rel="stylesheet" href="assets/bower_components/bootstrap/dist/css/bootstrap-theme.css"/>
		<script src="assets/bower_components/jquery/dist/jquery.min.js"></script>
		<script src="assets/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

		<script src="http://localhost:35729/livereload.js"></script>

		<!-- Twitter javascript -->
		<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

		<!-- Site styles -->
		<link rel="stylesheet" href="assets/css/style.css"/>
	</head>
	<body>
	</body>
	<div id="header">
		<h2 class="brand">Justin Manley</h2>
		<p>Coder, mapmaker, aspiring architecture critic, currently a student at the University of Chicago. I write about cities at <a href="http://outoftheyards.com.">outoftheyards.com</a>.</p>	
	</div>
	<div class="navbar" role="navigation">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#nav-links">
					<span class="sr-only">Toggle Navigation</span>
				</button>
			</div>
			<div class="collapse navbar-collapse" id="nav-links">
				<ul class="nav navbar-nav">
				
					<li><a href="https://github.com">GitHub</a></li>
				
					<li><a href="">Blog</a></li>
				
					<li><a href="http://outoftheyards.com">Out of the Yards</a></li>
				
					<li><a href="link/to/portfolio">Portfolio</a></li>
				
					<li><a href="/link/to/demos">Demos</a></li>
				
				</ul>
			</div>
		</div>
	</div>
	

<div class="container-fluid">
	<div class="row">
		
			<div class="col-md-4 feed">
				<div class="event github-event &lt;%= %>"><!-- issue_comment -->
<span class="mega-octicon octicon-comment-discussion"></span>

<div class="time">
  <time datetime="2014-08-21T16:54:02Z" is="relative-time">August 21, 2014</time>
</div>

<div class="title">
  <a href="https://github.com/manleyjster">manleyjster</a> <span>commented</span> on issue <a href="https://github.com/rails/sass-rails/issues/207#issuecomment-52948917" title="Update sprockets dependency">rails/sass-rails#207</a>
</div>

<div class="details">
  <a href="https://github.com/manleyjster"><img alt="Justin Manley" class="gravatar" data-user="1668487" height="30" src="https://avatars3.githubusercontent.com/u/1668487?v=2&amp;s=60" width="30" /></a>
  <div class="message markdown-body">
    <blockquote>
      <p>+1 
I'm having similar dependency issues when trying to install <code>sass-rails</code>. At first, <code>sass-rails</code> complained about my sprockets <code>2.12.1</code> installation,…</p>
    </blockquote>
  </div>
</div>
</div>
<div class="event github-event &lt;%= %>"><!-- push -->
<span class="mega-octicon octicon-git-commit"></span>

<div class="time">
  <time datetime="2014-08-19T21:08:47Z" is="relative-time">August 19, 2014</time>
</div>

<div class="title">
  <a href="https://github.com/manleyjster">manleyjster</a> <span>pushed</span> to <a href="/manleyjster/mapknitter/tree/annotation-interface">annotation-interface</a> at <a href="https://github.com/manleyjster/mapknitter" class="css-truncate css-truncate-target">manleyjster/mapknitter</a>
</div>

<div class="details">
  <a href="https://github.com/manleyjster"><img alt="Justin Manley" class="gravatar" data-user="1668487" height="30" src="https://avatars3.githubusercontent.com/u/1668487?v=2&amp;s=60" width="30" /></a>

    <div class="commits ">
      <ul>
        <li>
          <span title="xvidun">
            <img alt="vidun" data-user="6093280" height="16" src="https://avatars1.githubusercontent.com/u/6093280?v=2&amp;s=32" width="16" />
          </span>
          <code><a href="/manleyjster/mapknitter/commit/8fdcacee8e68ae87f806774e4f69143a0a5ece00">8fdcace</a></code>
          <div class="message">
            <blockquote>
              Completed callback after upload
            </blockquote>
          </div>
        </li>
        <li>
          <span title="xvidun">
            <img alt="vidun" data-user="6093280" height="16" src="https://avatars1.githubusercontent.com/u/6093280?v=2&amp;s=32" width="16" />
          </span>
          <code><a href="/manleyjster/mapknitter/commit/137caf0c14452a9450dca7bf683f75e73a697d1c">137caf0</a></code>
          <div class="message">
            <blockquote>
              Implementing callback to warper
            </blockquote>
          </div>
        </li>
        <li class="more"><a href="https://github.com/manleyjster/mapknitter/compare/19bd02ac4f...3dfbc3aaaa">64 more commits &raquo;</a></li>
      </ul>
    </div>
</div>
</div>
<div class="event publiclab-event &lt;%= %>">
  <div class="thumbnail">
    <img src="http://i.publiclab.org/system/images/photos/000/005/650/medium/header.png"/>
  </div>
  <div class="time">July 29, 2014</div>
  <div class="title">
    <a href="http://publiclab.org/profile/justinmanley">justinmanley</a>
    <span> published </span>
    <a href="http://publiclab.org//notes/justinmanley/07-29-2014/mapknitter-annotations-version-0-0-2-released-with-l-illustrate-textbox-and-l-illustrate-pointer">MapKnitter Annotations: Version 0.0.2 released with L.Illustrate.Textbox and L.Illustrate.Pointer</a>
  </div>
</div>
<div class="event github-event &lt;%= %>"><!-- issue_comment -->
<span class="mega-octicon octicon-comment-discussion"></span>

<div class="time">
  <time datetime="2014-08-20T17:34:42Z" is="relative-time">August 20, 2014</time>
</div>

<div class="title">
  <a href="https://github.com/manleyjster">manleyjster</a> <span>commented</span> on pull request <a href="https://github.com/publiclab/mapknitter/pull/21#issuecomment-52812808" title="Added leaflet beta urls to test image distortion, rotation, scaling, outline and opacity features">publiclab/mapknitter#21</a>
</div>

<div class="details">
  <a href="https://github.com/manleyjster"><img alt="Justin Manley" class="gravatar" data-user="1668487" height="30" src="https://avatars3.githubusercontent.com/u/1668487?v=2&amp;s=60" width="30" /></a>
  <div class="message markdown-body">
    <blockquote>
      <p>Haven't pulled in Anish's code yet - I'm still working on merging Vidun's work. I need to implement drag-upload-to-map so that uploaded images can …</p>
    </blockquote>
  </div>
</div>
</div>
<div class="event publiclab-event &lt;%= %>">
  <div class="thumbnail">
    <img src="http://i.publiclab.org/system/images/photos/000/006/340/medium/IMAG0382.jpg"/>
  </div>
  <div class="time">August 19, 2014</div>
  <div class="title">
    <a href="http://publiclab.org/profile/justinmanley">justinmanley</a>
    <span> published </span>
    <a href="http://publiclab.org//notes/justinmanley/08-19-2014/mapknitter-annotations-riffle-data-as-map-annotations">MapKnitter Annotations: Riffle Data as Map Annotations</a>
  </div>
</div>
<div class="event publiclab-event &lt;%= %>">
  <div class="thumbnail">
    <img src="http://i.publiclab.org/system/images/photos/000/005/260/medium/chicagooooo.png"/>
  </div>
  <div class="time">July 14, 2014</div>
  <div class="title">
    <a href="http://publiclab.org/profile/justinmanley">justinmanley</a>
    <span> published </span>
    <a href="http://publiclab.org//notes/justinmanley/07-14-2014/mapknitter-annotations-leaflet-illustrate-edithandle-and-leaflet-illustrate-pointer">MapKnitter Annotations: Leaflet.Illustrate.EditHandle and Leaflet.Illustrate.Pointer</a>
  </div>
</div>
<div class="event publiclab-event &lt;%= %>">
  <div class="thumbnail">
    <img src="http://i.publiclab.org/system/images/photos/000/004/823/medium/Barataria_12_june_trip_VI.png"/>
  </div>
  <div class="time">June 17, 2014</div>
  <div class="title">
    <a href="http://publiclab.org/profile/justinmanley">justinmanley</a>
    <span> published </span>
    <a href="http://publiclab.org//notes/justinmanley/06-17-2014/mapknitter-annotations-plugin-preliminary-specification">MapKnitter Annotations Plugin: Preliminary Specification</a>
  </div>
</div>
<div class="event github-event &lt;%= %>"><!-- push -->
<span class="mega-octicon octicon-git-commit"></span>

<div class="time">
  <time datetime="2014-08-22T22:57:20Z" is="relative-time">August 22, 2014</time>
</div>

<div class="title">
  <a href="https://github.com/manleyjster">manleyjster</a> <span>pushed</span> to <a href="/manleyjster/mapknitter/tree/annotation-interface">annotation-interface</a> at <a href="https://github.com/manleyjster/mapknitter" class="css-truncate css-truncate-target">manleyjster/mapknitter</a>
</div>

<div class="details">
  <a href="https://github.com/manleyjster"><img alt="Justin Manley" class="gravatar" data-user="1668487" height="30" src="https://avatars3.githubusercontent.com/u/1668487?v=2&amp;s=60" width="30" /></a>

    <div class="commits pusher-is-only-committer">
      <ul>
        <li>
          <span title="manleyjster">
            <img alt="Justin Manley" data-user="1668487" height="16" src="https://avatars2.githubusercontent.com/u/1668487?v=2&amp;s=32" width="16" />
          </span>
          <code><a href="/manleyjster/mapknitter/commit/4e591762b0037aab46dca317441437d77e14cb7a">4e59176</a></code>
          <div class="message">
            <blockquote>
              Add CONTRIBUTING.md and load high-resolution image on the map after t…
            </blockquote>
          </div>
        </li>
      </ul>
    </div>
</div>
</div>
<div class="event publiclab-event &lt;%= %>">
  <div class="thumbnail">
    <img src="http://i.publiclab.org/system/images/photos/000/005/650/medium/header.png"/>
  </div>
  <div class="time">July 29, 2014</div>
  <div class="title">
    <a href="http://publiclab.org/profile/justinmanley">justinmanley</a>
    <span> published </span>
    <a href="http://publiclab.org//notes/justinmanley/07-29-2014/mapknitter-annotations-version-0-0-2-released-with-l-illustrate-textbox-and-l-illustrate-pointer">MapKnitter Annotations: Version 0.0.2 released with L.Illustrate.Textbox and L.Illustrate.Pointer</a>
  </div>
</div>
<div class="event publiclab-event &lt;%= %>">
  <div class="thumbnail">
    <img src="http://i.publiclab.org/system/images/photos/000/004/964/medium/illustrate-textbox.png"/>
  </div>
  <div class="time">June 25, 2014</div>
  <div class="title">
    <a href="http://publiclab.org/profile/justinmanley">justinmanley</a>
    <span> published </span>
    <a href="http://publiclab.org//notes/justinmanley/06-25-2014/mapknitter-annotations-update-l-illustrate-textbox">MapKnitter Annotations Update: L.Illustrate.Textbox</a>
  </div>
</div>

			</div>
		

		
			<div class="col-md-8 feed">
				<div class="article">
  <h3 class="article-title">MapKnitter Annotations: Version 0.0.2 released with L.Illustrate.Textbox and L.Illustrate.Pointer</h3>
  <div class="article-date">July 29, 2014</div>
  <div class="article-souce">Posted on </div>
  <a href="http://publiclab.org//notes/justinmanley/07-29-2014/mapknitter-annotations-version-0-0-2-released-with-l-illustrate-textbox-and-l-illustrate-pointer">PublicLab.org.</a>
  <div class="article-body"><p><img src='http://i.publiclab.org/system/images/photos/000/005/650/medium/header.png'/><br /> ### Background ###</p>
<p>I am working to add rich annotation functionality to MapKnitter as part of Google Summer of Code (read about my project here: <a href="http://publiclab.org/notes/justinmanley/03-18-2014/mapknitter-annotations-using-fabric-js-gsoc-2014-proposal">http://publiclab.org/notes/justinmanley/03-18-2014/mapknitter-annotations-using-fabric-js-gsoc-2014-proposal</a>). This is my sixth week of coding. The purpose of this research note is to provide an update on my progress with implementing text annotation for Leaflet.</p>
<p>To trace the discussions that have led me up to this point, you can look back through the following research notes, listed in chronological order.</p>
<p>March 18, 2014 - <a href="http://publiclab.org/notes/justinmanley/03-18-2014/mapknitter-annotations-using-fabric-js-gsoc-2014-proposal">MapKnitter Annotations Using Fabric.js (GSoC 2014 Proposal)</a></p>
<p>June 17, 2014 - <a href="http://publiclab.org/notes/justinmanley/06-17-2014/mapknitter-annotations-plugin-preliminary-specification">MapKnitter Annotations Plugin: Preliminary Specification</a></p>
<p>June 25, 2014 - <a href="http://publiclab.org/notes/justinmanley/06-25-2014/mapknitter-annotations-update-l-illustrate-textbox">MapKnitter Annotations Update: L.Illustrate.Textbox</a></p>
<p>July 2, 2014 - <a href="http://publiclab.org/notes/justinmanley/07-02-2014/mapknitter-annotations-textbox-rotation-using-css-transforms">MapKnitter Annotations: Textbox Rotation using CSS Transforms</a></p>
<p>July 14, 2014 - <a href="http://publiclab.org/notes/justinmanley/07-14-2014/mapknitter-annotations-leaflet-illustrate-edithandle-and-leaflet-illustrate-pointer">MapKnitter Annotations: Leaflet.Illustrate.EditHandle and Leaflet.Illustrate.Pointer</a></p>
<p>You can view the <a href="https://github.com/manleyjster/Leaflet.Illustrate">code for Leaflet.Illustrate on GitHub</a> and you can view a demo using the version of Leaflet.Illustrate (0.0.2) released along with this research note on GitHub at <a href="http://manleyjster.github.io/Leaflet.Illustrate/examples/0.0.2/simple/">http://manleyjster.github.io/Leaflet.Illustrate/examples/0.0.2/simple/</a>:</p>
<h3 id="progress">Progress</h3>
<p><code>Leaflet.Illustrate</code> is done!  </p>
<p>Well, maybe not done.  <code>Leaflet.Illustrate</code> has reached the point where it can provide basic text annotation capability to the MapKnitter community, so I figure it&#39;s a good time to start integrating it with MapKnitter.  There&#39;s still much that can be done to improve <code>Leaflet.Illustrate</code> to ensure that it is a fast, robust, and dependable library for Leaflet text annotation.  Specifically:</p>
<ul>
<li>Tooltip text should be added to <code>Leaflet.Illustrate.tooltipText</code> to guide users through the annotation process</li>
<li><code>Leaflet.Illustrate.PointerHandle</code> should be refactored into two subclasses: <code>Leaflet.Illustrate.PointerVertexHandle</code> and <code>Leaflet.Illustrate.PointerMidpointHandle</code></li>
<li>All <code>Leaflet.Illustrate</code> code should be reviewed for instances of <code>L.Point</code> arithmetic, and, where possible, arithmetic methods should be replaced by their underscore-prefixed cousins (i.e. <code>L.Point._add</code> should be used instead of <code>L.Point.add</code>).  This is purely for efficiency.</li>
</ul>
<p>Here&#39;s what I&#39;ve been up to since I last posted:</p>
<h4 id="leaflet-illustrate-textbox">Leaflet.Illustrate.Textbox</h4>
<p>I fixed the <a href="http://publiclab.org/notes/justinmanley/07-14-2014/mapknitter-annotations-leaflet-illustrate-edithandle-and-leaflet-illustrate-pointer#Current+Challenges+and+TODO">annoying flickering</a> with the pointer connecting the rotate handle to the textbox in editing mode by making the pointer an instance of <code>L.Illustrate.Pointer</code>.  Of course, this required implementing <code>L.Illustrate.Pointer</code> from scratch - more on this below.</p>
<p>I was also able to fix text selection and cursor placement in textboxes by calling <code>L.DomEvent.stopPropagation</code> on <code>mousedown</code>, <code>mousemove</code>, and <code>mouseup</code> events from the <code>&lt;textarea&gt;</code>, thanks to a helpful suggestion from <a href="https://github.com/danzel">@danzel</a> on the GitHub issue I posted: <a href="https://github.com/Leaflet/Leaflet/issues/2813">How do I get text selection working for a textarea on top of the map?</a>.  </p>
<p>I encapsulated this functionality as <a href="https://github.com/manleyjster/Leaflet.Illustrate/blob/master/src/core/L.Illustrate.Textbox.js#L148"><code>L.Illustrate.Selectable</code></a>.  However, I still feel (as I wrote in the GitHub issue thread) that <code>L.Illustrate.Selectable</code> should be unecessary, as this should be taken care of by <a href="https://github.com/Leaflet/Leaflet/blob/stable/src/dom/Draggable.js#L39"><code>map.dragging.disable()</code></a> or by calling <a href="https://github.com/Leaflet/Leaflet/blob/stable/src/dom/DomUtil.js#L254"><code>L.DomUtil.enableTextSelection</code></a> directly.</p>
<h4 id="leaflet-illustrate-pointer">Leaflet.Illustrate.Pointer</h4>
<p>I spent a lot of my time over the past two weeks implementing <code>L.Illustrate.Pointer</code>.  A pointer is a line with only a single geographically-fixed point (the &quot;anchor&quot; point).  The coordinates of the line are given in pixels with respect to the anchor point.  The line thus maintains constant size through zoom events (it does not scale with the map):</p>
<pre><code>new L.Illustrate.Pointer(
    &lt;LatLng&gt; anchor, 
    &lt;Point[]&gt; coordinates, 
    &lt;Polyline options&gt; options?
)
</code></pre><p>The immediate purpose for the <code>L.Illustrate.Pointer</code> class was to provide a robust pointer for <code>L.Illustrate.Textbox</code> (see above), but <code>L.Illustrate.Pointer</code> can serve as a general-purpose pointer linking any large annotation to a single point on the map.</p>
<p>A few notes on the design of <code>L.Illustrate.Pointer</code>:</p>
<p>Each instance of <code>L.Illustrate.Pointer</code> has <a href="https://github.com/manleyjster/Leaflet.Illustrate/blob/master/src/core/L.Illustrate.Pointer.SVG.js#L23">its own containing <code>&lt;svg&gt;</code> element</a>.  This was done so that pointers would zoom smoothly using CSS3 transitions (CSS properties can only be applied to <code>&lt;svg&gt;</code> elements, and not their <code>&lt;g&gt;</code> or <code>&lt;path&gt;</code> children), since pointers with different anchor points would require different <code>css-transform</code> translations.  It is possible that this will raise performance issues if there are <em>lots</em> of pointers on the map, but I think that for most of our use cases it will present no issues.</p>
<p>In other respects, much of the code for <code>L.Illustrate.Pointer</code> is borrowed directly from <a href="https://github.com/Leaflet/Leaflet/blob/stable/src/layer/vector/Path.js"><code>L.Path</code></a>,  <a href="https://github.com/Leaflet/Leaflet/blob/stable/src/layer/vector/Path.SVG.js"><code>L.Path.SVG</code></a>, and <a href="https://github.com/Leaflet/Leaflet/blob/stable/src/layer/vector/Polyline.js"><code>L.Polyline</code></a> when it was not possible for it to inherit from them explicitly.</p>
<p>As it turns out, the editing handles for <code>L.Illustrate.Pointer</code> were <em>much</em> more difficult to design than those for <code>L.Illustrate.Textbox</code>.  This is because the position of an editing handle for <code>L.Illustrate.Textbox</code> is fixed: a handle which starts out at the upper left corner will always be at the upper left corner (disregarding rotations).  Editing handles for polylines, by contrast, can change position as vertices are added and deleted - and throughout, they must be in exact correspondence with the coordinates of the polyline so that dragging a handle updates the correct vertex.</p>
<p>My approach, similar to the approach I used for <a href="https://github.com/manleyjster/Leaflet.Illustrate/blob/master/src/edit/handles/L.Illustrate.RotateHandle.js"><code>L.Illustrate.RotateHandle</code></a>, etc. - but different from <a href="https://github.com/jacobtoye">@jacobtoye</a>&#39;s approach in <a href="https://github.com/Leaflet/Leaflet.draw">Leaflet.draw</a>, was to delegate as much as possible of the UI logic to the handles themselves.</p>
<p>The way I ended up implementing this was that <code>drag</code> or <code>click</code> events on a handle call the <a href="https://github.com/manleyjster/Leaflet.Illustrate/blob/v0.0.2/src/edit/L.Illustrate.Edit.Pointer.js#L75"><code>_addVertex</code></a>, <a href="https://github.com/manleyjster/Leaflet.Illustrate/blob/v0.0.2/src/edit/L.Illustrate.Edit.Pointer.js#L48"><code>_removeVertex</code></a>, or <a href="https://github.com/manleyjster/Leaflet.Illustrate/blob/v0.0.2/src/edit/L.Illustrate.Edit.Pointer.js#L95"><code>_updateVertex</code></a> methods of <code>L.Illustrate.Edit.Pointer</code>.  These methods of <code>L.Illustrate.Edit.Pointer</code> handle the creation and destruction of instances of <code>L.Illustrate.PointerHandle</code> as necessary to add and remove vertices from the pointer.  Once this is complete, the method fires an <code>edit:add-vertex</code>, <code>edit:remove-vertex</code>, or <code>edit:update-vertex</code> event.  Instances of <code>L.Illustrate.PointerHandle</code> listen for these events and each is responsible for updating its own <code>_id</code> property (the <code>_id</code> property indicates which vertex the handle controls).</p>
<p>My hope was that implementing editing handles in this way would enable the editing handles to be highly decoupled from <code>L.Illustrate.Pointer</code> and <code>L.Illustrate.Edit.Pointer</code>.  I think that the implementation was relatively successful from that perspective - but it is excessively complicated by the need for each handle to maintain an accurate internal <code>_id</code> property linking it to the correct coordinate.  This might be simplified by splitting <code>L.Illustrate.PointerHandle</code> into two separate classes and giving each vertex handle responsibility for the midpoint handles to either side.</p>
<h4 id="miscellaneous-updates">Miscellaneous Updates</h4>
<p>Since my last research note, I completed a number of housekeeping tasks:</p>
<ul>
<li>Connected <code>Leaflet.Illustrate</code> repo to <a href="https://travis-ci.org/manleyjster/Leaflet.Illustrate">Travis CI</a></li>
<li>Connected <code>Leaflet.Illustrate</code> repo to <a href="https://coveralls.io/r/manleyjster/Leaflet.Illustrate">Coveralls</a></li>
<li>Published <code>Leaflet.Illustrate</code> to <code>npm</code> as <a href="https://www.npmjs.org/package/leaflet-illustrate"><code>leaflet-illustrate</code></a></li>
<li>Added release tags for v0.0.1 and v0.0.2 in git</li>
<li>Added build, coverage, and version badges to the <a href="https://github.com/manleyjster/Leaflet.Illustrate/blob/master/README.md"><code>README</code></a>.</li>
</ul>
<p>It is my hope that these additions will give others confidence in the quality of this Leaflet plugin and encourage them to contribute or to use it for their own projects.</p>
<h3 id="next-steps-future-improvements">Next Steps &amp; Future Improvements</h3>
<ul>
<li>Fork MapKnitter repo and begin working on integrating <code>Leaflet.Illustrate</code> into MapKnitter.</li>
<li>Refactor <code>L.Illustrate.PointerHandle</code></li>
<li>Extend <code>L.Illustrate.Toolbar</code> to provide an intuitive interface for users to change the color, font, font-size, and other styles on the textbox and other features.</li>
<li>Implement <code>toGeoJSON</code> methods for <code>L.Illustrate.Pointer</code> and <code>L.Illustrate.Textbox</code> (will probably use <code>toGeoJSON</code> to serialize these objects for storage in the MapKnitter database)</li>
<li>Allow textboxes to be fixed at points other than their center points</li>
<li>Fix feature deletion button in toolbar</li>
</ul>
</div>
</div>

			</div>
						
	</div>
</div><!-- #feeds -->
</html>